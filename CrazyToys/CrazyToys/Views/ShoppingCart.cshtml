@using CrazyToys.Entities.DTOs
@using Newtonsoft.Json
@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<ShoppingCart>
@{
    Layout = "Master.cshtml";
    List<ShoppingCartToyDTO> shoppingCartToyDTOs = ViewData["ShoppingCartToytDTOs"] as  List<ShoppingCartToyDTO>;

    double subtotal = 0.0;
    double deliveryPrice = 39;
    foreach (ShoppingCartToyDTO shoppingCartToyDTO in shoppingCartToyDTOs)
    {
        subtotal = subtotal + shoppingCartToyDTO.Price * shoppingCartToyDTO.Quantity;
    }
    if(subtotal > 499.0)
    {
        deliveryPrice = 0.0;
    }

    double total = subtotal + deliveryPrice;

    // updateCartTotalPrices(@Html.Raw(JsonConvert.SerializeObject(shoppingCartToyDTOs)))
}


<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Indkøbskurv</h4>
                    <div class="breadcrumb__links">
                        <a href="/">Forside</a>
                        <a href="/shop">Butik</a>
                        <span>Indkøbskurv</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- Shopping Cart Section Begin -->
<section class="shopping-cart spad">
    <div class="container">
        <div class="row">
            <div id="tableWrapper" class="col-lg-8">
                @{
                    @if (shoppingCartToyDTOs.Count > 0)
                    {
                        <div id="toyTable" class="shopping__cart__table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Produkt</th>
                                        <th>Antal</th>
                                        <th>Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="toyTableBody">
                            
                                @foreach(ShoppingCartToyDTO toyDTO in shoppingCartToyDTOs){
                                    <tr id="toyDataRow-@toyDTO.ID">
                                        <td class="product__cart__item">
                                            <div class="product__cart__item__pic mouse-hover" onclick='redirect("/shop-details?id=@toyDTO.ID")'>
                                                <img class="cart-image-size" src="@toyDTO.Image" alt="@toyDTO.Name">
                                            </div>
                                            <div class="product__cart__item__text">
                                                <h6 class="text-capitalize mouse-hover" onclick='redirect("/shop-details?id=@toyDTO.ID")'>@toyDTO.Name</h6>
                                                <h5>@toyDTO.Price DKK</h5>
                                            </div>
                                        </td>
                                        <td class="quantity__item">
                                            <div class="quantity">
                                                <div class="pro-qty-2">
                                                    <span class="fa fa-angle-left dec qtybtn mouse-hover" onclick='decQuantity(@Html.Raw(JsonConvert.SerializeObject(toyDTO)))'></span>
                                                    <input id="chosenAmount-@toyDTO.ID" type="text" value="@toyDTO.Quantity">
                                                    <span class="fa fa-angle-right inc qtybtn mouse-hover" onclick='incQuantity(@Html.Raw(JsonConvert.SerializeObject(toyDTO)))'></span>
                                                </div>
                                            </div>
                                        </td>
                                        <td id="total-@toyDTO.ID" class="cart__price">@(toyDTO.Price * toyDTO.Quantity) DKK</td>
                                        <td class="cart__close" onclick='removeToyFromCart(@Html.Raw(JsonConvert.SerializeObject(toyDTO)))'><i class="fa fa-close mouse-hover"></i></td>
                                    </tr>
                                }
                             
                                </tbody>
                            </table>
                        </div>
                       }
                       else
                       {
                            <h2 class="headline">Der er intet i kurven endnu</h2>
                       }
                }
                <!--
                <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="continue__btn">
                <a href="#">Continue Shopping</a>
                </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="continue__btn update__btn">
                <a href="./shopping-cart"><i class="fa fa-spinner"></i> Update cart</a>
                </div>
                </div>
                </div>
                -->
            </div>
            <div class="col-lg-4">
                <!--
                <div class="cart__discount">
                <h6>Rabatkode</h6>
                <form action="#">
                <input type="text" placeholder="Rabatkode">
                <button type="submit">Indløs</button>
                </form>
                </div>
                -->
              
                <div class="cart__total">
                    <h6>Pris i alt</h6>
                    <ul>
                        <li>Subtotal <span id="subtotal" class="font-weight-normal black">@subtotal DKK</span></li>
                        <li class="font-italic">Levering <span id="deliveryPrice" class="font-weight-normal black">@(deliveryPrice < 1 ? "Gratis levering" : deliveryPrice + " DKK")</span></li>
                            <li class="free">
                            @{
                                var priceToFreeShipping = 499 - subtotal;
                                var text = priceToFreeShipping > 0
                                    ? @priceToFreeShipping + " DKK til gratis fragt"
                                    : "";
                                <p id="priceToFreeShipping" class="text-center small">@text</p>
                            }
                            </li>
                        <hr>
                        <li class="font-weight-bold">Pris i alt (inkl. moms) <span id="total" class="black">@total DKK</span></li>
                    </ul>
                    <a href="/checkout" class="primary-btn">Videre til kassen</a>
                </div>
                <br>
                <p class="font-italic text-center">Varerne er ikke reserverede før du går videre i købet</p>
            </div>
        </div>
    </div>
</section>
<!-- Shopping Cart Section End -->